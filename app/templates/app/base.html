<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      .container {
        margin-top: 20px;
      };
      .nav {
        margin-top: 20px;
        margin-bottom: 20px;
      };

      .table {
        margin-top: 20px;
      };

      .progress {
        padding-top: 30px !important;
      }

    </style>
  </head>
  <body>
  <div class="container">
      <div class="jumbotron text-center">
        <h1>Styrkleikalisti Taekwondodeildar Ármanns</h1>
        <p class="lead">Styrkleikalistinn er reiknaður eftir stigakerfi deildarinnar.</p>
      </div>
      <div class="row marketing">
        <div class="col-xs-12 col-md-6 col-md-offset-3">
          <ul class="nav nav-pills nav-justified">
            <li role="presentation" class="active"><a id="total" href="/ranking/">Heildarstig</a></li>
            <li role="presentation"><a id="sparring" href="/ranking/category/1/">Sparring</a></li>
            <li role="presentation"><a id="poomsae" href="/ranking/category/2/">Púmse</a></li>
          </ul>          
        </div>
      </div>
      <div class="row marketing">
        <div class="col-xs-12 col-md-6 col-md-offset-3">

          <table id="ranking" class="table table-condensed table-striped">
            <thead> 
              <tr> 
                <th>#</th>                
                <th>Iðkandi</th> 
                <th>Heildarstig</th>
              </tr> 
            </thead>
            <tbody>
            </tbody>
          </table>  

        </div>

      </div>

      <footer class="footer text-center">
        <p>&copy; 2015 Ármann Taekwondo.</p>
      </footer>

    </div> <!-- /container -->


    <div id="myModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title"></h4>
          </div>   
          <div class="modal-body">
            
            <table id="profile" class="table table-condensed table-striped">
              <thead> 
                <tr> 
                  <th>Dags</th>                
                  <th>Mót</th>
                  <th>Keppnisgrein</th> 
                  <th>Sæti</th>
                  <th>Stig</th>
                </tr> 
              </thead>
              <tbody>
              </tbody>
            </table>           
          </div>
        </div>
      </div>
    </div>        
  
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
    <script>

    function getScore (url) {
      $('#ranking > tbody').empty();
      $.ajax({
          url: url,
          type: 'GET',
          success: function(data){ 
            data.sort(orderPoints);

            $.each( data, function( key, value ) {
              $('#ranking > tbody').append(          
                '<tr>' + 
                  '<td id="rank">' + (key+1) + '</td>' +  
                  '<td id="name"><a href="ranking/athlete/'+value.id+'/">' + value.name + '</a>' + '</td>' +
                  '<td id="points">'+value.points + '</td>' +
                '</tr>');
              
            });
          },
          error: function(data) {
              console.log(data); //or whatever
          }
      });        
    };

    function getAthlete (url) { 
      $('#profile > tbody').empty();     
      $.ajax({
          url: url,
          type: 'GET',
          success: function(data){   
            $('.modal-title').text(data[0].record[0].name);
            $.each( data, function(i, record) {              
              $.each( record, function(x, item) {
                $.each(item, function(key, value) {
                  $('#profile > tbody').append(          
                    '<tr>' + 
                      '<td>' + value.date + '</td>' +  
                      '<td>' + value.tournament + '</td>' +
                      '<td>' + value.category + '</td>' +
                      '<td>'+ value.place + '</td>' +
                      '<td>'+ value.points + '</td>' +
                    '</tr>');
                  
                });
              });
            });

            $('#myModal').modal();
          },
          error: function(data) {
              console.log(data); //or whatever
          }
      });        
    };

    function orderPoints(a,b) {
      return parseInt(b.points, 10) - parseInt(a.points, 10);
    };

    $(document).on('click','#name > a',function(e){
      e.preventDefault();
      getAthlete($("#name > a").attr('href'));     
      return false;
    });

    $("#total").click(function(event) {
      event.preventDefault();
      $('li').removeClass('active');
      $("#total").parent().addClass('active');
      console.log($("#total").attr('href'));
      getScore($("#total").attr('href'));
    });

    $("#sparring").click(function(event) {
      event.preventDefault();
      $('li').removeClass('active');
      $("#sparring").parent().addClass('active');
      getScore($("#sparring").attr('href'));
    });
    
    $("#poomsae").click(function(event) {
      event.preventDefault();
      $('li').removeClass('active');
      $("#poomsae").parent().addClass('active');
      getScore($("#poomsae").attr('href'));
    });    

    window.onload = getScore('/ranking/');

    </script>
  </body>
</html>